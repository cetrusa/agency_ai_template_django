{#
CRUD UI KIT · list.html

Pantalla principal (full page SSR) que:
- Renderiza toolbar + filtros + alerts + contenedor de tabla.
- La tabla se carga/actualiza por HTMX (sin recargar el layout).

Contrato (backend):
- crud_urls: dict con urls absolutas o relativas:
  - list, table, create, bulk
  - edit_template: patrón o builder en backend (ver _row_actions.html)
- page_title: str
- entity_label: str (singular) y entity_label_plural: str (plural)
- current_filters: dict {q, status, from, to, sort, dir, page}
- total_count: int

Notas HTMX:
- #crud-table hace hx-get a crud_urls.table y se refresca al disparar el evento "crudChanged".
- Los filtros usan hx-get y hx-push-url para mantener querystring compartible.
#}

{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title|default:"Listado" }}{% endblock %}

{% block head %}
  <link href="{% static 'css/crud.css' %}" rel="stylesheet" />
{% endblock %}

{% block content %}
  <div class="crud-page">
    {# Alerts (reutilizable). Se puede actualizar OOB tras acciones. #}
    <div id="crud-alerts">
      {% include 'crud/_alerts.html' %}
    </div>

    <div class="crud-toolbar d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3">
      <div>
        <div class="ds-title h4 mb-1">{{ page_title|default:entity_label_plural|default:"Listado" }}</div>
        <div class="ds-muted">{{ total_count|default:0 }} registros</div>
      </div>

      <div class="d-flex gap-2">
        {# Botón "Nuevo" abre modal y trae contenido por HTMX. #}
        <button class="btn btn-primary btn-sm"
                type="button"
                hx-get="{{ crud_urls.create }}"
          hx-target="#modal-host"
          hx-swap="innerHTML"
                hx-indicator="#crud-indicator">
          <i class="bi bi-plus-lg"></i>
          Nuevo {{ entity_label|default:"" }}
        </button>
      </div>
    </div>

    <div class="crud-filters mb-3">
      {% include 'crud/_filters.html' %}
    </div>

    {# Loading indicator global para requests de tabla/modales. #}
    <div id="crud-indicator" class="crud-indicator htmx-indicator" aria-live="polite" aria-busy="true">
      <div class="spinner-border spinner-border-sm" role="status" aria-label="Cargando"></div>
      <span class="ms-2">Cargando…</span>
    </div>

    {#
      Contenedor de tabla:
      - load: primera carga
      - crudChanged: refresco tras create/edit/delete/bulk (disparado por backend via HX-Trigger)
    #}
    <section id="crud-table"
             hx-get="{{ crud_urls.table }}"
             hx-trigger="load, crudChanged from:body"
             hx-swap="innerHTML"
             hx-indicator="#crud-indicator">
      <div class="ds-card">
        <div class="ds-card-body">
          <div class="ds-skeleton ds-h-18 ds-w-220"></div>
          <div class="ds-skeleton ds-h-360 mt-3"></div>
        </div>
      </div>
    </section>
  </div>
{% endblock %}

{% block body_end %}
  <script src="{% static 'js/crud.js' %}"></script>
{% endblock %}
